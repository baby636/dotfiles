#!/bin/bash -e

{{ $op_version := "1.3.0" -}}

which op 1>/dev/null && echo "OnePassword CLI already installed" && exit 0

cd /tmp
{{ if eq .chezmoi.os "linux" -}}
wget -O op.zip https://cache.agilebits.com/dist/1P/op/pkg/v{{- $op_version -}}/op_linux_amd64_v1.3.0.zip
unzip op.zip
gpg2 --keyserver hkp://keys.gnupg.net --recv-keys 3FEF9748469ADBE15DA7CA80AC2D62742012EA22
gpg2 --verify op.sig op
mv op ~/bin/

{{ else if eq .chezmoi.os "darwin" -}}
wget -O op.pkg https://cache.agilebits.com/dist/1P/op/pkg/v{{- $op_version -}}/op_darwin_amd64_v1.3.0.pkg
# TODO: Follow verification steps as mentioned here https://n-o-d-e.net/verify.html
sudo installer -pkg op.pkg -target /

{{ end -}}
