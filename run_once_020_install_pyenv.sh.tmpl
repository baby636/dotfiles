#!/bin/bash -e
{{ $pyenv_version := "1.2.19" -}}
{{ $pyenv_virtualenv_version := "1.1.5" -}}
{{ $global_python_version := "3.7.7" -}}

sudo apt install -y build-essential libssl-dev zlib1g-dev libbz2-dev \
libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev \
xz-utils tk-dev libffi-dev liblzma-dev python-openssl git \
    || echo "pyenv prerequisites satisfied"

which pyenv || \
    (git clone https://github.com/pyenv/pyenv.git ~/.pyenv && \
     cd ~/.pyenv && \
     git checkout v{{ $pyenv_version }})

(pyenv versions | grep {{ $global_python_version }}) || env PYTHON_CONFIGURE_OPTS="--enable-shared" pyenv install {{ $global_python_version }}
pyenv global {{ $global_python_version }}

pyenv virtualenv --help || \
    (cd $(pyenv root)/plugins && \
     git clone https://github.com/pyenv/pyenv-virtualenv.git && \
     cd pyenv-virtualenv && \
     git checkout v{{ $pyenv_virtualenv_version }})
